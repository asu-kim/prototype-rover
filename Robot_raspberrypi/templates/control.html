<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motor and Camera Control</title>
    <style>
        .control-image {
            width: 150px;
            height: 100px;
            cursor: pointer;
            margin: 10px;
        }
        body {
            text-align: center;
        }
    </style>
    <script>
        let moveInterval;
        let speed = 50;  // Default speed
        let steering = 0;  // Default steering (centered)

        function sendDirection(direction) {
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/move", true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.send(`direction=${direction}&speed=${speed}&steering=${steering}`);
        }

        function startMoving(direction) {
            stopMoving();  // Ensure any previous movement is stopped
            moveInterval = setInterval(function () {
                sendDirection(direction);
            }, 100);  // Send the request every 100ms
        }

        function stopMoving() {
            if (moveInterval) {
                clearInterval(moveInterval);
                sendDirection('stop');  // Stop the robot when button is released
                moveInterval = null;
            }
        }

        function updateSpeed(value) {
            speed = value;
            document.getElementById("speed-display").textContent = value;
        }

        function updateSteering(value) {
            steering = value;
            document.getElementById("steering-display").textContent = value;
        }

        function startRecording() {
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/record", true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.send("action=start");
            xhr.onload = function () {
                if (xhr.status === 200) {
                    alert("Recording started");
                } else {
                    alert("Error starting recording: " + xhr.responseText);
                }
            };
        }

        function stopRecording() {
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/record", true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.send("action=stop");
            xhr.onload = function () {
                if (xhr.status === 200) {
                    alert("Recording stopped");
                } else {
                    alert("Error stopping recording: " + xhr.responseText);
                }
            };
        }
    </script>
</head>
<body>
    <h1>Robot Control</h1>

    <!-- Control Buttons -->
    <div>
        <img src="/static/forward.jpg" class="control-image"
            onmousedown="startMoving('forward')" 
            onmouseup="stopMoving()" alt="Forward">
        <img src="/static/backward.jpg" class="control-image"
            onmousedown="startMoving('backward')" 
            onmouseup="stopMoving()" alt="Backward">
    </div>

    <!-- Speed Slider -->
    <div>
        <h2>Speed Control</h2>
        <input type="range" min="0" max="100" value="50" oninput="updateSpeed(this.value)">
        <p>Speed: <span id="speed-display">50</span></p>
    </div>

    <!-- Steering Slider -->
    <div>
        <h2>Steering Control (Left/Right)</h2>
        <input type="range" min="-25" max="25" value="0" oninput="updateSteering(this.value)">
        <p>Steering Angle: <span id="steering-display">0</span></p>
    </div>

    <!-- Recording Buttons -->
    <div>
        <h2>Video Recording</h2>
        <button onclick="startRecording()">Start Recording</button>
        <button onclick="stopRecording()">Stop Recording</button>
    </div>
</body>
</html>
